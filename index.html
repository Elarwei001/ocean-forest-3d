<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean Forest - WebGL Octopus Adventure</title>
    <link rel="stylesheet" href="assets/styles/webgl-style.css">
</head>
<body>
    <!-- WebGL Canvas -->
    <canvas id="webgl-canvas"></canvas>
    
    <!-- Loading screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <h2>ğŸŒŠ Loading Ocean Forest...</h2>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p>Preparing your underwater adventure</p>
        </div>
    </div>
    
    <!-- UI Overlay -->
    <div id="ui-overlay">
        <div id="controls">
            <h3>ğŸ™ ç« é±¼æ§åˆ¶ / Octopus Controls</h3>
            <p><strong>WASD/æ–¹å‘é”® / Arrow Keys:</strong> ç§»åŠ¨ / Move around</p>
            <p><strong>é¼ æ ‡ / Mouse:</strong> è§‚å¯Ÿ / Look around</p>
            <p><strong>Mé”® / M Key:</strong> åˆ‡æ¢é¼ æ ‡æ§åˆ¶ / Toggle mouse control</p>
            <p><strong>ç©ºæ ¼ / Space:</strong> ä¸Šæ¸¸ / Swim up</p>
            <p><strong>Shift:</strong> ä¸‹æ¸¸ / Swim down</p>
            <div class="info">æ¬¢è¿æ¥åˆ°å—éæµ·æ´‹æ£®æ— / Welcome to South African Ocean Forest</div>
        </div>
        
        <div id="performance">
            <div>FPS: <span id="fps">60</span></div>
            <div>ğŸŒ¿ Kelp: <span id="kelp-count">0</span></div>
            <div>ğŸŸ Fish: <span id="fish-count">0</span></div>
            <div>ğŸ¦­ Seals: <span id="seal-count">0</span></div>
            <div>ğŸ§ Penguins: <span id="penguin-count">0</span></div>
            <div>ğŸ¦ˆ Sharks: <span id="shark-count">0</span></div>
        </div>
        
        <!-- Educational Information Panel -->
        <div id="species-info" class="hidden">
            <div class="species-content">
                <button id="close-info" class="close-btn">Ã—</button>
                <div class="species-header">
                    <div class="species-photo">
                        <img id="species-image" src="" alt="Species Photo" />
                        <div class="photo-credit">ğŸ“¸ Photo</div>
                    </div>
                    <div class="species-names">
                        <h3 id="species-name"></h3>
                        <h4 id="species-english"></h4>
                    </div>
                </div>
                <div id="species-facts"></div>
                <p class="info-hint">ğŸ–±ï¸ ç‚¹å‡»æµ·æ´‹ç”Ÿç‰©äº†è§£æ›´å¤šçŸ¥è¯† / Click marine animals to learn more</p>
            </div>
        </div>
    </div>
    
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Module Manager (must load first) -->
    <script src="src/core/ModuleManager.js"></script>
    
    <!-- Core Modules -->
    <script src="src/core/OceanForest.js"></script>
    
    <!-- Model Modules -->
    <script src="src/models/OceanEnvironment.js"></script>
    <script src="src/models/OctopusModel.js"></script>
    <script src="src/models/MarineAnimals.js"></script>
    <script src="src/models/SharkModel.js"></script>
    <script src="src/models/ReefFishModel.js"></script>
    <script src="src/models/SharksAndFish.js"></script>
    
    <!-- System Modules -->
    <script src="src/systems/AudioSystem.js"></script>
    <script src="src/systems/EducationSystem.js"></script>
    <script src="src/systems/RenderEngine.js"></script>

    <!-- Cinematic Systems -->
    <script src="src/systems/CinematicAnimationSystem.js"></script>
    <script src="src/systems/AdvancedParticleSystem.js"></script>
    <script src="src/systems/MarineLifeBehavior.js"></script>
    <script src="src/systems/CinematicCameraSystem.js"></script>
    <script src="src/ui/CinematicControlPanel.js"></script>
    
    <!-- Main Application Initialization -->
    <script>
        // Initialize Ocean Forest Application
        let oceanForest = null;
        
        window.addEventListener('load', async () => {
            try {
                // Wait for all modules to load
                if (window.moduleManager) {
                    console.log('ğŸ”„ ç­‰å¾…æ¨¡å—åŠ è½½...');
                    const moduleReady = await window.moduleManager.waitForModules();
                    
                    if (moduleReady) {
                        // Initialize main application
                        const OceanForest = window.moduleManager.getModule('OceanForest');
                        if (OceanForest) {
                            oceanForest = new OceanForest();
                            window.oceanForest = oceanForest; // Make globally available
                            
                            console.log('ğŸŒŠ Ocean Forest Application Started');
                            console.log('ğŸ¬ Initializing cinematic systems...');
                            
                            // Initialize control panel after ocean forest is ready
                            setTimeout(() => {
                                console.log('ğŸ® å¼€å§‹åˆå§‹åŒ–æ§åˆ¶é¢æ¿...');
                                console.log('æ£€æŸ¥ CinematicControlPanel ç±»:', !!window.CinematicControlPanel);
                                console.log('æ£€æŸ¥ç°æœ‰é¢æ¿å®ä¾‹:', !!window.cinematicPanel);
                                
                                // å¼ºåˆ¶åˆå§‹åŒ–æ§åˆ¶é¢æ¿
                                if (window.CinematicControlPanel) {
                                    try {
                                        window.cinematicPanel = new CinematicControlPanel();
                                        console.log('âœ… ç”µå½±çº§æ§åˆ¶é¢æ¿å·²å¼ºåˆ¶åˆå§‹åŒ–');
                                        // ç«‹å³æ£€æŸ¥çŠ¶æ€
                                        setTimeout(() => {
                                            if (window.cinematicPanel) {
                                                window.cinematicPanel.checkStatus();
                                                console.log('ğŸ¬ æ§åˆ¶é¢æ¿çŠ¶æ€æ£€æŸ¥å®Œæˆ');
                                            }
                                        }, 500);
                                    } catch (error) {
                                        console.error('âŒ æ§åˆ¶é¢æ¿åˆå§‹åŒ–å¤±è´¥:', error);
                                    }
                                } else {
                                    console.error('âŒ CinematicControlPanelç±»æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥è„šæœ¬åŠ è½½');
                                    // åˆ—å‡ºå½“å‰windowä¸‹æ‰€æœ‰å¯ç”¨çš„å˜é‡
                                    console.log('å½“å‰windowå¯¹è±¡ä¸­çš„ç›¸å…³å˜é‡:');
                                    Object.keys(window).filter(key => key.toLowerCase().includes('cinema')).forEach(key => {
                                        console.log(' -', key, ':', typeof window[key]);
                                    });
                                }
                            }, 2000);
                            
                        } else {
                            console.error('âŒ OceanForest module not found');
                        }
                    } else {
                        console.error('âŒ Required modules failed to load');
                    }
                } else {
                    console.error('âŒ Module manager not found');
                }
            } catch (error) {
                console.error('âŒ Application initialization failed:', error);
            }
        });
    </script>
</body>
</html>